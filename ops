{"author":{"id":"f6e2c84cbd41daecf4582d969b556a96eb202b5bed142fd85d6e07732fc4fe19"},"ops":[{"type":3,"timestamp":1727257391,"nonce":"S3e4P9ZaKtuJeRkKVOjIER6k6BE=","metadata":{"github-id":"IC_kwDOBLCY8M6Nehex","github-url":"https://github.com/svpcom/wfb-ng/issues/371#issuecomment-2373588913"},"message":"**There are some troubles here:**\n\n1. I looked into the format of RTP packets containing timestamps, and it seems that the RTP timestamp differs from what I understand as a system timestamp.\n\n- RTP timestamps, something related to camera clock\n```\n// Define RTP header structure\ntypedef struct {\n    // First byte: Version (2 bits), Padding (1 bit), Extension (1 bit), CSRC count (4 bits)\n    uint8_t vpxcc;  \n    \n    // Second byte: Marker (1 bit), Payload Type (7 bits)\n    uint8_t mpt;    \n    \n    // Sequence number (16 bits)\n    uint16_t sequence_number;  \n    \n    // Timestamp (32 bits)\n    uint32_t timestamp;  \n    \n    // SSRC (32 bits, synchronization source identifier)\n    uint32_t ssrc;            \n    \n} rtp_header_t;\n```\n-  system time from epoch\n```\nstruct timespec {\n    time_t tv_sec;   // Seconds since the Epoch (Jan 1, 1970)\n    long   tv_nsec;  // Nanoseconds (1 second = 1,000,000,000 nanoseconds)\n};\n```\n2. Additionally, if IMU data is injected into the image data stream, it would involve wfb-ng interacting with the application logic rather than merely functioning as an RF communication channel software. \n\n3. I am not entirely sure when the start of a data frame occurs.\n\n**Therefore, I would like to confirm the following questions:**\n\n1. During the testing process of wfb-ng, does polling for data in the code indicate the start of a frame is avaliable?\n\nhttps://github.com/svpcom/wfb-ng/blob/7d9367ade04973cdfbe2c52dcf64ae5a96b438ff/src/tx.cpp#L932-L935\n\n2. And at that moment, does the UDP stream remain uninterrupted until the entire data is fully transmitted, continuously running in the `for(;;)` loop?\n\nhttps://github.com/svpcom/wfb-ng/blob/7d9367ade04973cdfbe2c52dcf64ae5a96b438ff/src/tx.cpp#L940\n\n\n**If the above undestading is OK, then** \n\n1. Assuming the system time is obtained from the scenario in question 1. Then I can send this system timestamp to the backend server indicating a image frame is obtained at that moment.\n\n2.  Both the timestamp and IMU data are sent to the server through another wfb-ng channel, which just add a hook to wfb-ng for sending the timestamp to local imu agent. If there is an opensource image capture program, I think it will NOT be necessary to modify any of wfb-ng code. But right now, majestic is NOT opensouce.\n\n3. The imu agent is mainly focused on sending timestamped imu data and image timestamp marker to back server using anohter wfb-ng tunnel. (Maybe a time sync alignment function can be implemented to see TOF between the agent and server.)\n \n4. Then the server compare and match the image timestamp upon receiving the frame data? (Of course, certain anomalies such as packet loss might need to be handled.)\n\nPlease let me know what have got in your mind? Any advice? Thanks.","files":null}]}