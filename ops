{"author":{"id":"5722d727d47d8e7ce90c3de2001bb6f227e262dc347ff89650ccc18002cfa301"},"ops":[{"type":6,"timestamp":1731284801,"nonce":"WvFA7kZFhUu3fO6OQnpxUVxyB0g=","metadata":{"github-id":"UCE_lAHOBLCY8M6d0qdBzmmpJ64"},"target":"866fe3158a42dc309e5a17153c6614fbcf54700e06aef7c0ab594c6451bb0b67","message":"**Describe the bug**\nI'm not sure if WFB-ng's binary log in msgpack format is considered as part of public interfaces, but I'm working on using it for customized OSD https://github.com/OpenIPC/PixelPilot_rk/issues/18\nbut got stuck on a fact that [some of msgpack parsers](https://json.nlohmann.me/features/binary_formats/messagepack/) can not parse msgpack with non-string map keys.\nIn Python it also requires `strict_map_key=False`.\n\n```python\n'rx_ant_stats': {\n  ((5805, 1, 20), 1): (661, -38, -37, -37, 8, 31, 37),\n  ((5805, 1, 20), 0): (661, -42, -40, -40, 5, 30, 35)\n}\n```\n\n**To Reproduce**\n\n```cpp\n#include \u003cnlohmann/json.hpp\u003e\n\nusing json = nlohmann::json;\n...\njson::from_msgpack(buf, buf + size, false, true);\n```\n\nWhen `buf` contains the wfb-ng's binary log, this code will crash because library does not support non-string map keys.\n\n**Expected behavior**\n\nI think in order to make the binary log more compatible with various msgpack parsers, the format should either use maps with string keys or use array, eg\n\n```python\n\"rx_ant_stats\": [\n {\"ant\": (5805, 1, 20), 1),\n  \"stats\": (661, -38, -37, -37, 8, 31, 37)},\n{\"ant\": (5805, 1, 20), 0),\n \"stats\": (661, -42, -40, -40, 5, 30, 35)}\n]\n```\n\n**Your setup (please complete the following information):**\n - OS Debian\n - Hardware Radxa Zero 3W\n - WiFi cards rtl8812eu\n - WiFi drivers from FPV ground station for Radxa 3\n\n**Additional context**\nSee https://github.com/OpenIPC/PixelPilot_rk/issues/18\n\n**Confirm you read**\n- [x]  https://github.com/svpcom/wfb-ng/blob/master/README.md\n- [ ]  https://github.com/svpcom/wfb-ng/wiki/Setup-HOWTO","files":null},{"type":6,"timestamp":1731284802,"nonce":"pwLTql0Mweqsydz6B8HvW45vpD0=","metadata":{"github-id":"UCE_lAHOBLCY8M6d0qdBzmmpJ8M"},"target":"866fe3158a42dc309e5a17153c6614fbcf54700e06aef7c0ab594c6451bb0b67","message":"**Describe the bug**\nI'm not sure if WFB-ng's binary log in msgpack format is considered as part of public interfaces, but I'm working on using it for customized OSD https://github.com/OpenIPC/PixelPilot_rk/issues/18\nbut got stuck on a fact that [some of msgpack parsers](https://json.nlohmann.me/features/binary_formats/messagepack/) can not parse msgpack with non-string map keys.\nIn Python it also requires `strict_map_key=False`.\n\n```python\n'rx_ant_stats': {\n  ((5805, 1, 20), 1): (661, -38, -37, -37, 8, 31, 37),\n  ((5805, 1, 20), 0): (661, -42, -40, -40, 5, 30, 35)\n}\n```\n\n**To Reproduce**\n\n```cpp\n#include \u003cnlohmann/json.hpp\u003e\n\nusing json = nlohmann::json;\n...\njson::from_msgpack(buf, buf + size, false, true);\n```\n\nWhen `buf` contains the wfb-ng's binary log, this code will crash because library does not support non-string map keys.\n\n**Expected behavior**\n\nI think in order to make the binary log more compatible with various msgpack parsers, the format should either use maps with string keys or use array, eg\n\n```python\n\"rx_ant_stats\": [\n {\"ant\": (5805, 1, 20), 1),\n  \"stats\": (661, -38, -37, -37, 8, 31, 37)},\n{\"ant\": (5805, 1, 20), 0),\n \"stats\": (661, -42, -40, -40, 5, 30, 35)}\n]\n```\n\n**Your setup (please complete the following information):**\n - OS Debian\n - Hardware Radxa Zero 3W\n - WiFi cards rtl8812eu\n - WiFi drivers from FPV ground station for Radxa 3\n\n**Additional context**\nSee https://github.com/OpenIPC/PixelPilot_rk/issues/18\n\n**Confirm you read**\n- [x]  https://github.com/svpcom/wfb-ng/blob/master/README.md\n- [x]  https://github.com/svpcom/wfb-ng/wiki/Setup-HOWTO","files":null}]}