{"author":{"id":"0220b34f0b1af65233ff5d312b6119cb2ec468f2855c750c72813f4a38760220"},"ops":[{"type":3,"timestamp":1724560205,"nonce":"13yxslayhbs4E0Sdn+U9xqXfGGk=","metadata":{"github-id":"IC_kwDOBLCY8M6JmzaM","github-url":"https://github.com/svpcom/wfb-ng/issues/365#issuecomment-2308650636"},"message":"\u003e @zhouruixi Thanks for your dumps. They help me a lot to find root of this bug.\n\u003e \n\u003e Quick solution for IPQ8074 is patch rx.cpp:\n\u003e \n\u003e ```diff\n\u003e @@ -242,7 +243,8 @@ void Receiver::loop_iter(void)\n\u003e          /* discard the radiotap header part */\n\u003e          pkt += iterator._max_length;\n\u003e          pktlen -= iterator._max_length;\n\u003e +        pktlen -= 8 ;\n\u003e        \n\u003e          //fprintf(stderr, \"CAPTURE: mcs: %u, bw: %u\\n\", mcs_index, bandwidth);\n\u003e          if (pktlen \u003e (int)sizeof(ieee80211_header))\n\u003e          {\n\u003e ```\n\u003e \n\u003e but I've not found a good way to distinguish bad and good cards during run time. So for quick and dirty solution you can add condition into code if interface name equals to \"bad card\" then do `pktlen -= 8 ;`\n\n1. It works on IPQ8074, but fails on wifi5. Does pktlen affect wfb aggregator?\n2. We need more testing (wifi6 devices from other manufacturers, different drivers, and even wifi7 devices). If enough devices have pktlen issues, we can consider adding an additional command line flag","files":null},{"type":6,"timestamp":1724560679,"nonce":"/487mpeuOZbn4gjE9iUc1o4gVOI=","metadata":{"github-id":"UCE_lALOBLCY8M6JmzaMzk4Gywg"},"target":"6ecea5c6683623f77e7ad41143828079aadd128b259d7a08c5b3cc5d5dbfad52","message":"\u003e @zhouruixi Thanks for your dumps. They help me a lot to find root of this bug.\n\u003e \n\u003e Quick solution for IPQ8074 is patch rx.cpp:\n\u003e \n\u003e ```diff\n\u003e @@ -242,7 +243,8 @@ void Receiver::loop_iter(void)\n\u003e          /* discard the radiotap header part */\n\u003e          pkt += iterator._max_length;\n\u003e          pktlen -= iterator._max_length;\n\u003e +        pktlen -= 8 ;\n\u003e        \n\u003e          //fprintf(stderr, \"CAPTURE: mcs: %u, bw: %u\\n\", mcs_index, bandwidth);\n\u003e          if (pktlen \u003e (int)sizeof(ieee80211_header))\n\u003e          {\n\u003e ```\n\u003e \n\u003e but I've not found a good way to distinguish bad and good cards during run time. So for quick and dirty solution you can add condition into code if interface name equals to \"bad card\" then do `pktlen -= 8 ;`\n\n1. It works on IPQ8074, but fails on wifi5. Does pktlen affect wfb aggregator?\n2. We need more testing (wifi6 devices from other manufacturers, different drivers, and even wifi7 devices), If enough devices have pktlen issues and no effective way to detect and identify, we need an additional command line flag.","files":null}]}