{"author":{"id":"018822160af4ec0627353c2536e0391b59141b7a2b5c6830ac409a8962edfed6"},"ops":[{"type":1,"timestamp":1678948410,"nonce":"OsRqkYo7L3t12IQxHFnWUmolq0k=","metadata":{"github-id":"I_kwDOBLCY8M5g9y-l","github-url":"https://github.com/svpcom/wfb-ng/issues/292","origin":"github"},"title":"[BUG] don't compile in arm32v7/ubuntu","message":"**Describe the bug**\n`make deb` breaks inside debhelper\n\n**To Reproduce**\n\nmy Dockerfile:\n\n```\nFROM arm32v7/ubuntu:latest\n\nRUN apt update \u0026\u0026 \\\n  apt install -y build-essential git wget \\\n    virtualenv fakeroot debhelper \\\n    libpcap-dev libsodium-dev \\\n    python3-twisted python3-pyroute2 \\\n    python3-future python3-all\n\nRUN git clone https://github.com/svpcom/wfb-ng.git --depth 1 --branch wfb-ng-23.01\nWORKDIR /wfb-ng\n\nRUN make deb\n```\n\nI launch it on arm64 ubuntu:\n\n\n\n```\ndocker build -t wfb-pkg .\nSending build context to Docker daemon  3.072kB\nStep 1/5 : FROM arm32v7/ubuntu:latest\n ---\u003e f3a711451e14\nStep 2/5 : RUN apt update \u0026\u0026   apt install -y build-essential git wget     virtualenv fakeroot debhelper     libpcap-dev libsodium-dev     python3-twisted python3-pyroute2     python3-future python3-all\n ---\u003e Using cache\n ---\u003e 60eff4e3cc58\nStep 3/5 : RUN git clone https://github.com/svpcom/wfb-ng.git --depth 1 --branch wfb-ng-23.01\n ---\u003e Using cache\n ---\u003e 0be485ecd2c7\nStep 4/5 : WORKDIR /wfb-ng\n ---\u003e Using cache\n ---\u003e 1b1e6159cb53\nStep 5/5 : RUN make deb\n ---\u003e [Warning] The requested image's platform (linux/arm/v7) does not match the detected host platform (linux/amd64) and no specific platform was requested\n ---\u003e Running in 898c46793f8b\ng++  -Wall -O2 -DWFB_VERSION='\"23.1.16.78051-4886033f\"' -std=gnu++11 -c -o src/rx.o src/rx.cpp\ncc  -Wall -O2 -DWFB_VERSION='\"23.1.16.78051-4886033f\"' -std=gnu99 -c -o src/radiotap.o src/radiotap.c\nsrc/radiotap.c: In function 'ieee80211_radiotap_iterator_init':\nsrc/radiotap.c:116:34: warning: taking address of packed member of 'struct ieee80211_radiotap_header' may result in an unaligned pointer value [-Waddress-of-packed-member]\n  116 |         iterator-\u003e_next_bitmap = \u0026radiotap_header-\u003eit_present;\n      |                                  ^~~~~~~~~~~~~~~~~~~~~~~~~~~~\ncc  -Wall -O2 -DWFB_VERSION='\"23.1.16.78051-4886033f\"' -std=gnu99 -c -o src/fec.o src/fec.c\ng++  -Wall -O2 -DWFB_VERSION='\"23.1.16.78051-4886033f\"' -std=gnu++11 -c -o src/wifibroadcast.o src/wifibroadcast.cpp\ng++ -o wfb_rx src/rx.o src/radiotap.o src/fec.o src/wifibroadcast.o  -lrt -lpcap -lsodium\ng++  -Wall -O2 -DWFB_VERSION='\"23.1.16.78051-4886033f\"' -std=gnu++11 -c -o src/tx.o src/tx.cpp\ng++ -o wfb_tx src/tx.o src/fec.o src/wifibroadcast.o  -lrt -lpcap -lsodium\ncc  -Wall -O2 -DWFB_VERSION='\"23.1.16.78051-4886033f\"' -std=gnu99 -c -o src/keygen.o src/keygen.c\ncc -o wfb_keygen src/keygen.o  -lrt -lpcap -lsodium\nvirtualenv env --python=/usr/bin/python3\ncreated virtual environment CPython3.10.6.final.0-32 in 1730ms\n  creator CPython3Posix(dest=/wfb-ng/env, clear=False, no_vcs_ignore=False, global=False)\n  seeder FromAppData(download=False, pip=bundle, setuptools=bundle, wheel=bundle, via=copy, app_data_dir=/root/.local/share/virtualenv)\n    added seed packages: pip==22.0.2, setuptools==59.6.0, wheel==0.37.1\n  activators BashActivator,CShellActivator,FishActivator,NushellActivator,PowerShellActivator,PythonActivator\n./env/bin/pip install --upgrade pip setuptools stdeb\nRequirement already satisfied: pip in ./env/lib/python3.10/site-packages (22.0.2)\nCollecting pip\n  Downloading pip-23.0.1-py3-none-any.whl (2.1 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 2.1/2.1 MB 4.5 MB/s eta 0:00:00\nRequirement already satisfied: setuptools in ./env/lib/python3.10/site-packages (59.6.0)\nCollecting setuptools\n  Downloading setuptools-67.6.0-py3-none-any.whl (1.1 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 1.1/1.1 MB 8.2 MB/s eta 0:00:00\nCollecting stdeb\n  Downloading stdeb-0.10.0.tar.gz (57 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 57.3/57.3 KB 2.9 MB/s eta 0:00:00\n  Preparing metadata (setup.py): started\n  Preparing metadata (setup.py): finished with status 'done'\nBuilding wheels for collected packages: stdeb\n  Building wheel for stdeb (setup.py): started\n  Building wheel for stdeb (setup.py): finished with status 'done'\n  Created wheel for stdeb: filename=stdeb-0.10.0-py3-none-any.whl size=42848 sha256=122d9088c30182b81c987b697f93a4a81fd340f36cc7119ef4c24e58e3bd49fc\n  Stored in directory: /root/.cache/pip/wheels/cc/2d/ec/d3fc47bd87b1d7b8d4e1847b4fe6942f162e56818684040c33\nSuccessfully built stdeb\nInstalling collected packages: stdeb, setuptools, pip\n  Attempting uninstall: setuptools\n    Found existing installation: setuptools 59.6.0\n    Uninstalling setuptools-59.6.0:\n      Successfully uninstalled setuptools-59.6.0\n  Attempting uninstall: pip\n    Found existing installation: pip 22.0.2\n    Uninstalling pip-22.0.2:\n      Successfully uninstalled pip-22.0.2\nSuccessfully installed pip-23.0.1 setuptools-67.6.0 stdeb-0.10.0\nrm -rf deb_dist\n./env/bin/python ./setup.py --command-packages=stdeb.command bdist_deb\nrunning bdist_deb\nrunning sdist_dsc\nrunning egg_info\ncreating wfb_ng.egg-info\nwriting wfb_ng.egg-info/PKG-INFO\nwriting dependency_links to wfb_ng.egg-info/dependency_links.txt\nwriting entry points to wfb_ng.egg-info/entry_points.txt\nwriting top-level names to wfb_ng.egg-info/top_level.txt\nwriting manifest file 'wfb_ng.egg-info/SOURCES.txt'\nreading manifest file 'wfb_ng.egg-info/SOURCES.txt'\nadding license file 'LICENSE.txt'\nwriting manifest file 'wfb_ng.egg-info/SOURCES.txt'\nrunning sdist\nrunning check\ncreating wfb-ng-23.1.16.78051\ncreating wfb-ng-23.1.16.78051/scripts\ncreating wfb-ng-23.1.16.78051/scripts/default\ncreating wfb-ng-23.1.16.78051/wfb_ng\ncreating wfb-ng-23.1.16.78051/wfb_ng.egg-info\ncreating wfb-ng-23.1.16.78051/wfb_ng/conf\ncopying files to wfb-ng-23.1.16.78051...\ncopying LICENSE.txt -\u003e wfb-ng-23.1.16.78051\ncopying README.md -\u003e wfb-ng-23.1.16.78051\ncopying setup.py -\u003e wfb-ng-23.1.16.78051\ncopying wfb_keygen -\u003e wfb-ng-23.1.16.78051\ncopying wfb_rx -\u003e wfb-ng-23.1.16.78051\ncopying wfb_tx -\u003e wfb-ng-23.1.16.78051\ncopying scripts/98-wifibroadcast.conf -\u003e wfb-ng-23.1.16.78051/scripts\ncopying scripts/wifibroadcast -\u003e wfb-ng-23.1.16.78051/scripts\ncopying scripts/wifibroadcast.service -\u003e wfb-ng-23.1.16.78051/scripts\ncopying scripts/wifibroadcast@.service -\u003e wfb-ng-23.1.16.78051/scripts\ncopying scripts/default/wifibroadcast -\u003e wfb-ng-23.1.16.78051/scripts/default\ncopying wfb_ng/__init__.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/cli.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/common.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/config_parser.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/latency_test.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/mavlink.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/mavlink_protocol.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/proxy.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/server.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng/tuntap.py -\u003e wfb-ng-23.1.16.78051/wfb_ng\ncopying wfb_ng.egg-info/PKG-INFO -\u003e wfb-ng-23.1.16.78051/wfb_ng.egg-info\ncopying wfb_ng.egg-info/SOURCES.txt -\u003e wfb-ng-23.1.16.78051/wfb_ng.egg-info\ncopying wfb_ng.egg-info/dependency_links.txt -\u003e wfb-ng-23.1.16.78051/wfb_ng.egg-info\ncopying wfb_ng.egg-info/entry_points.txt -\u003e wfb-ng-23.1.16.78051/wfb_ng.egg-info\ncopying wfb_ng.egg-info/not-zip-safe -\u003e wfb-ng-23.1.16.78051/wfb_ng.egg-info\ncopying wfb_ng.egg-info/top_level.txt -\u003e wfb-ng-23.1.16.78051/wfb_ng.egg-info\ncopying wfb_ng/conf/__init__.py -\u003e wfb-ng-23.1.16.78051/wfb_ng/conf\ncopying wfb_ng/conf/master.cfg -\u003e wfb-ng-23.1.16.78051/wfb_ng/conf\ncopying wfb_ng/conf/site.cfg -\u003e wfb-ng-23.1.16.78051/wfb_ng/conf\nWriting wfb-ng-23.1.16.78051/setup.cfg\ncreating dist\nCreating tar archive\nremoving 'wfb-ng-23.1.16.78051' (and everything under it)\ndpkg-buildpackage: info: source package wfb-ng\ndpkg-buildpackage: info: source version 23.1.16.78051-1\ndpkg-buildpackage: info: source distribution unstable\ndpkg-buildpackage: info: source changed by None \u003cNone\u003e\n dpkg-source --before-build .\ndpkg-source: info: using options from wfb-ng-23.1.16.78051/debian/source/options: --extend-diff-ignore=\\.egg-info$\n debian/rules clean\nmake[1]: Entering directory '/wfb-ng/deb_dist/wfb-ng-23.1.16.78051'\ndh clean --with python3 --buildsystem=python_distutils\ndh: warning: Compatibility levels before 10 are deprecated (level 9 in use)\ndh: error: unable to load addon python3: Can't locate Debian/Debhelper/Sequence/python3.pm in @INC (you may need to install the Debian::Debhelper::Sequence::python3 module) (@INC contains: /etc/perl /usr/local/lib/arm-linux-gnueabihf/perl/5.34.0 /usr/local/share/perl/5.34.0 /usr/lib/arm-linux-gnueabihf/perl5/5.34 /usr/share/perl5 /usr/lib/arm-linux-gnueabihf/perl-base /usr/lib/arm-linux-gnueabihf/perl/5.34 /usr/share/perl/5.34 /usr/local/lib/site_perl) at (eval 10) line 1.\nBEGIN failed--compilation aborted at (eval 10) line 1.\n\nmake[1]: *** [debian/rules:7: clean] Error 25\nmake[1]: Leaving directory '/wfb-ng/deb_dist/wfb-ng-23.1.16.78051'\ndpkg-buildpackage: error: debian/rules clean subprocess returned exit status 2\nTraceback (most recent call last):\n  File \"/wfb-ng/./setup.py\", line 62, in \u003cmodule\u003e\n    setup(\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/__init__.py\", line 108, in setup\n    return distutils.core.setup(**attrs)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/_distutils/core.py\", line 185, in setup\n    return run_commands(dist)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/_distutils/core.py\", line 201, in run_commands\n    dist.run_commands()\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/_distutils/dist.py\", line 969, in run_commands\n    self.run_command(cmd)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/dist.py\", line 1221, in run_command\n    super().run_command(command)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/_distutils/dist.py\", line 988, in run_command\n    cmd_obj.run()\n  File \"/wfb-ng/env/lib/python3.10/site-packages/stdeb/command/bdist_deb.py\", line 34, in run\n    self.run_command('sdist_dsc')\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/_distutils/cmd.py\", line 318, in run_command\n    self.distribution.run_command(command)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/dist.py\", line 1221, in run_command\n    super().run_command(command)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/setuptools/_distutils/dist.py\", line 988, in run_command\n    cmd_obj.run()\n  File \"/wfb-ng/env/lib/python3.10/site-packages/stdeb/command/sdist_dsc.py\", line 137, in run\n    build_dsc(debinfo,\n  File \"/wfb-ng/env/lib/python3.10/site-packages/stdeb/util.py\", line 1569, in build_dsc\n    dpkg_buildpackage(*args, cwd=fullpath_repackaged_dirname)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/stdeb/util.py\", line 585, in dpkg_buildpackage\n    process_command(args, cwd=cwd)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/stdeb/util.py\", line 226, in process_command\n    check_call(args, cwd=cwd)\n  File \"/wfb-ng/env/lib/python3.10/site-packages/stdeb/util.py\", line 59, in check_call\n    raise CalledProcessError(retcode)\nstdeb.util.CalledProcessError: 2\nmake: *** [Makefile:48: deb] Error 1\nThe command '/bin/sh -c make deb' returned a non-zero code: 2\nmake: *** [Makefile:2: all] Error 2\n```\n\n\n**Expected behavior**\n\nShould finish with building deb package\n\n\n**Confirm you read**\n- [x]  https://github.com/svpcom/wfb-ng/blob/master/README.md\n- [x]  https://github.com/svpcom/wfb-ng/wiki/Setup-HOWTO","files":null}]}